"use strict";!function(e){function n(e){h({cmd:p.nonce}).then(function(n){e(n)}).fail(function(n,t,o){console.error(n,t,o),e(!0)})}function t(e){h({cmd:p.state}).done(function(n,t,o){a(n.user),void 0!==e&&e(!("success"===t),n.logged_in,n.user)}).fail(function(n,t,o){console.error(n,t,o),e(!0)})}function o(e,n){h({cmd:p.data,fields:e}).done(function(e,t,o){d(e),void 0!==n&&n(!("success"===t),e)}).fail(function(e,t,o){console.error(e,t,o),n(!0)})}function c(e,t){n(function(n){t(_.assign(e,n))})}function u(e){h({cmd:p.activity}).done(function(n,t,o){void 0!==e&&e("success"!==t,n.items)}).fail(function(n,t,o){console.error(n,t,o),e(!0)})}function i(e,n,t){c({user:e,password:n,cmd:p.login},function(e){h(e).then(function(e,n,o){a(e.user),void 0!==t&&t(!("success"==n&&1==e.logged_in),e)}).fail(function(e,n,o){console.error(e,n,o),t(!0)})})}function s(e){c({cmd:p.logout},function(n){h(n).then(function(n,t,o){r(),m(),void 0!==e&&e(!("success"==t&&1==n.success),n)}).fail(function(n,t,o){console.error(n,t,o),e(!0)})})}function a(e){E.user=_.assign(E.user||{},e),y.setItem("cached_community_user",JSON.stringify(E.user)),document.body.dispatchEvent(f(E.EVENT.user_update))}function r(){y.removeItem("cached_community_user"),document.body.dispatchEvent(f(E.EVENT.user_update))}function d(e){Object.keys(e).forEach(n=>{E["userData_"+n]=e[n],y.setItem("cached_community_user_data_"+n,E["userData_"+n])}),document.body.dispatchEvent(f(E.EVENT.user_data_update))}function m(e){Object.keys(localStorage).forEach(e=>{0===e.indexOf("cached_community_user_data_")&&y.removeItem(e)}),document.body.dispatchEvent(f(E.EVENT.user_data_update))}function f(e){var e=null;return"function"==typeof Event?e=new Event(e):(e=document.createEvent("Event")).initEvent(e,!0,!0),e}function l(e){return null==E.user||void 0!==e&&!1!==e?(E.user=JSON.parse(y.getItem("cached_community_user")),E.user):E.user}function h(n){return e.ajax({method:"POST",url:g,data:n,xhrFields:{withCredentials:!0},dataType:"json",crossDomain:!0,timeout:3e4,cache:!1})}function v(n,t){var o={method:"POST",xhrFields:{withCredentials:!0},crossDomain:!0,timeout:1e4,cache:!1};for(var c in t)t.hasOwnProperty(c)&&(o[c]=t[c]);return e.ajax("//"+E.domains.community+n,t)}var y=localStorage,E=CachedCommunity,g=E.ajaxurl,p=E.commands;E.EVENT={user_update:"cached_community_user_update",user_data_update:"cached_community_user_data_update"},E.user=null,E.nonce=n,E.is_logged_in=t,E.get_user_data=o,E.set_nonce=c,E.get_activity=u,E.login=i,E.logout=s,E.get_user=l,E.request=function(e,n){return n.cmd=e,h(n)},E.ajax=v}(jQuery);